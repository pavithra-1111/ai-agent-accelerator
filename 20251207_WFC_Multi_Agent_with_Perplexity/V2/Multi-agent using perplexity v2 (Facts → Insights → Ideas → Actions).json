{
  "name": "Multi-agent using perplexity v2 (Facts → Insights → Ideas → Actions)",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -352,
        -144
      ],
      "id": "d91f0e1c-6301-44e1-9c60-484f3106e8b4",
      "name": "When chat message received",
      "webhookId": "101e3a3d-9f4b-49c1-8d55-55bfc69edd23"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "You are the Orchestrator Agent for the model Facts → Insights → Ideas → Actions.\n\nProcess:\n1. Send the user's exact question to the Facts Agent. Wait for the Perplexity-based output.\n2. Send the same question plus the Facts output to the Insights Agent.\n3. Send the same question plus Facts and Insights to the Ideas Agent.\n4. Send all previous outputs to the Actions Agent.\n5. Combine everything into this structure:\n\nFacts:\nInsights:\nIdeas:\nActions:\n\nRules:\n- Do not add new information. Use only the content generated by the four agents.\n- Do not guess or assume anything not stated by the agents.\n- Do not generate facts. Only merge.\n- If an agent output is limited, include it as is."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -144,
        -144
      ],
      "id": "fa9e18f1-a9ae-4060-9afb-0f8a011f0aaf",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -176,
        80
      ],
      "id": "63155ca1-5dbe-4222-ab51-f9dcb544ff87",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1184,
        304
      ],
      "id": "78afa3f0-cdc8-49f8-9d3a-9aa49c94ade5",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        1360,
        304
      ],
      "id": "e88932ca-2e00-4866-89ca-379e6364d856",
      "name": "Message a model in Perplexity",
      "credentials": {
        "perplexityApi": {
          "id": "R6WpKV3hMLPs656O",
          "name": "Arpan's Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        464,
        304
      ],
      "id": "718f0dfa-5c17-4314-89ba-6b4e948d7849",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        640,
        304
      ],
      "id": "c6e5bfa5-96c2-495a-a650-a60b33a6e379",
      "name": "Message a model in Perplexity1",
      "credentials": {
        "perplexityApi": {
          "id": "R6WpKV3hMLPs656O",
          "name": "Arpan's Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        112,
        304
      ],
      "id": "7077d451-0f15-4f26-ba1d-8d98e4eebba1",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        288,
        304
      ],
      "id": "ba28a934-eed7-4e14-a3f5-9ff6eda0c2ba",
      "name": "Message a model in Perplexity2",
      "credentials": {
        "perplexityApi": {
          "id": "R6WpKV3hMLPs656O",
          "name": "Arpan's Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -48,
        160
      ],
      "id": "dc49a462-986a-48ce-9ebc-b18b3f42327a",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        816,
        304
      ],
      "id": "9c05bd68-f97d-4bea-b305-28e90bdd51e3",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        992,
        304
      ],
      "id": "d5bb3eb8-1e3a-4462-aedd-241106fe2d91",
      "name": "Message a model in Perplexity3",
      "credentials": {
        "perplexityApi": {
          "id": "R6WpKV3hMLPs656O",
          "name": "Arpan's Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Facts Agent",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "You are the Facts Agent. You must ALWAYS call the Perplexity tool to gather factual information.\n\nRules:\n- Begin every response by calling Perplexity with the user’s question.\n- Use ONLY the Perplexity results to produce your factual summary.\n- If Perplexity has limited or unclear information, state the limitation clearly.\n- Do not add internal model knowledge. Do not guess.\n- Do not provide insights, ideas, or actions. Only verified factual information.\n\nOutput:\nA concise factual summary derived only from Perplexity search results."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        144,
        112
      ],
      "id": "45a3e9b8-d7ca-4303-bea3-5255c126b8fd",
      "name": "Facts"
    },
    {
      "parameters": {
        "toolDescription": "Insights Agent",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "You are the Insights Agent. You must ALWAYS call the Perplexity tool.\n\nProcess:\n1. Call Perplexity using the user’s question.\n2. Combine:\n   - Perplexity results\n   - Facts output from the previous agent\n3. Extract meaning, implications, patterns, constraints, and opportunities.\n\nRules:\n- Do not create or assume new facts.\n- Insights must be grounded in Perplexity results and the Facts output.\n- No ideas or recommendations. Only interpretation of meaning.\n- If facts are unclear, indicate uncertainty.\n\nOutput:\nA list of grounded insights based ONLY on Perplexity and the Facts step."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        448,
        112
      ],
      "id": "c660ed45-3b66-4527-b1ee-b951f05fa8d6",
      "name": "Insights"
    },
    {
      "parameters": {
        "toolDescription": "Ideas agent",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "You are the Ideas Agent. You must ALWAYS call the Perplexity tool before generating ideas.\n\nProcess:\n1. Call Perplexity with the user’s question.\n2. Combine:\n   - Perplexity results\n   - Facts output\n   - Insights output\n3. Generate realistic and creative ideas based on this combined information.\n\nRules:\n- Ideas must be possibilities, not factual claims.\n- Do not introduce any idea that contradicts Perplexity results.\n- No risks. No action steps. Just ideas.\n- Do not guess or fabricate context.\n\nOutput:\nA short list of 3 to 6 grounded idea possibilities."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        768,
        112
      ],
      "id": "a10ab7ef-1a5a-4119-bc05-18f81582437a",
      "name": "Ideas"
    },
    {
      "parameters": {
        "toolDescription": "Action Agent",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "You are the Actions Agent. You must ALWAYS call the Perplexity tool before producing actions.\n\nProcess:\n1. Call Perplexity with the user’s question.\n2. Combine:\n   - Perplexity results\n   - Facts\n   - Insights\n   - Ideas\n3. Produce a clear and realistic action plan.\n\nRules:\n- Do not add new facts.\n- Actions must be grounded in the previous three steps and Perplexity evidence.\n- If facts or ideas are unclear, mention constraints but produce the best plan possible.\n\nOutput:\nA concise step by step action plan."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        1120,
        96
      ],
      "id": "814baab1-631a-41f1-b455-7431840d46d0",
      "name": "Actions"
    },
    {
      "parameters": {
        "content": "## Sample Input \n\n1. I want to build a productized AI automation service using n8n and voice agents. Which customer segment should I target and what kind of problems should I solve for them.\n\n2. I want to grow a personal brand on LinkedIn around AI automations and n8n. Tell me what the landscape looks like and how I can differentiate.\n\n3. My company sells online courses for working professionals. We want to use AI to improve our student experience. What are the most useful ways other companies are using AI in education.",
        "height": 192,
        "width": 1328
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -352,
        -400
      ],
      "typeVersion": 1,
      "id": "cb35875b-04aa-4307-8997-569ba1498bb4",
      "name": "Sticky Note"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Actions",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message a model in Perplexity": {
      "ai_tool": [
        [
          {
            "node": "Actions",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Insights",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message a model in Perplexity1": {
      "ai_tool": [
        [
          {
            "node": "Insights",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Facts",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message a model in Perplexity2": {
      "ai_tool": [
        [
          {
            "node": "Facts",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Ideas",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message a model in Perplexity3": {
      "ai_tool": [
        [
          {
            "node": "Ideas",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Facts": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Insights": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Ideas": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Actions": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "66391712-5295-48db-818f-57b8105d4000",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "966c9717c649ff58138114ad4ec0792ba6c6dbbaefbc75a95d7e5ed34f041958"
  },
  "id": "jmD3sYwSINBdKr7F",
  "tags": []
}