{
  "name": "Multi-agent using perplexity v1 (Problem → Options → Risks → Recommendation)",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -352,
        -144
      ],
      "id": "8b90ebf9-272c-42d0-a34e-cf2e0d1825f9",
      "name": "When chat message received",
      "webhookId": "7153b5fb-97e0-4ff8-b177-e083e5f95a71"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "You are the Orchestrator Agent for the model Problem → Options → Risks → Recommendation.\n\nProcess:\n1. Send the user's question to the Problem Agent and wait for the Perplexity-based output.\n2. Send the question plus the Problem output to the Options Agent.\n3. Send the question, Problem, and Options outputs to the Risks Agent.\n4. Send all outputs to the Recommendation Agent.\n5. Combine everything into the final structure:\n\nProblem:\nOptions:\nRisks:\nRecommendation:\n\nRules:\n- Do not create new content. Only merge.\n- Do not assume facts or examples that were not provided by the agents.\n- Clearly separate each section.\n- If any output is limited, include it as is."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -144,
        -144
      ],
      "id": "44f8f016-6b77-4b8b-83d7-6ffd0e4d9f9f",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -176,
        80
      ],
      "id": "8774069d-2a60-455f-9c34-4c46a4719e53",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1184,
        304
      ],
      "id": "c95710b4-6c63-4499-b8ba-cc6ab59ac0a9",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        1360,
        304
      ],
      "id": "a0f688dd-dbbb-4c98-8093-a0b217f06330",
      "name": "Message a model in Perplexity",
      "credentials": {
        "perplexityApi": {
          "id": "R6WpKV3hMLPs656O",
          "name": "Arpan's Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        464,
        304
      ],
      "id": "d51e4bf0-23e9-4b00-8d52-462e02e810d5",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        640,
        304
      ],
      "id": "cc9ae668-68e1-4c71-b010-2af402e4c1d7",
      "name": "Message a model in Perplexity1",
      "credentials": {
        "perplexityApi": {
          "id": "R6WpKV3hMLPs656O",
          "name": "Arpan's Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        112,
        304
      ],
      "id": "044a3ffa-7f1d-481a-b57d-27b7d8a0ff5e",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        288,
        304
      ],
      "id": "bae1aa54-5666-4cbd-9ce6-ee7af0c3e2f1",
      "name": "Message a model in Perplexity2",
      "credentials": {
        "perplexityApi": {
          "id": "R6WpKV3hMLPs656O",
          "name": "Arpan's Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -48,
        160
      ],
      "id": "0f9f28b5-169c-4e7d-a045-386514a44be1",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        816,
        304
      ],
      "id": "1d7970ae-d835-4e84-b958-d736222f893f",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "iRiikErYVYL2GFKy",
          "name": "arpan_gemini_paid_key"
        }
      }
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message0_Text', ``, 'string') }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        992,
        304
      ],
      "id": "19ba1bb3-6097-4352-9cc7-d6ed40ef19da",
      "name": "Message a model in Perplexity3",
      "credentials": {
        "perplexityApi": {
          "id": "R6WpKV3hMLPs656O",
          "name": "Arpan's Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "You are the Problem Agent. You must ALWAYS call the Perplexity tool.\n\nProcess:\n1. Call Perplexity using the user’s question.\n2. Use ONLY Perplexity results + the user’s text to define the problem clearly.\n\nRules:\n- Do not guess or assume anything outside Perplexity evidence or user text.\n- Do not produce solutions, options, risks, or recommendations.\n- If Perplexity does not provide relevant context, state the limitation.\n\nOutput:\nA clear factual definition of the problem."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        144,
        112
      ],
      "id": "3cc92832-06f1-4e6a-9f66-8b1f86f0e25b",
      "name": "Problem"
    },
    {
      "parameters": {
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "You are the Options Agent. You must ALWAYS call the Perplexity tool.\n\nProcess:\n1. Call Perplexity using the user’s question.\n2. Combine:\n   - Perplexity results\n   - Problem definition\n3. Generate multiple realistic and grounded solution options.\n\nRules:\n- Do not propose options that contradict Perplexity’s findings.\n- Do not present ideas as facts.\n- No risk analysis.\n- No recommendation.\n\nOutput:\nA list of 3 to 6 grounded options."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        448,
        112
      ],
      "id": "9ef0a9ef-e4cb-45a5-966f-00e0c09d688c",
      "name": "Options"
    },
    {
      "parameters": {
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "You are the Risks Agent. You must ALWAYS call the Perplexity tool.\n\nProcess:\n1. Call Perplexity using the user’s question.\n2. Combine:\n   - Perplexity results\n   - Problem output\n   - Options output\n3. Identify realistic risks, weaknesses, or limitations.\n\nRules:\n- Do not invent case studies, numbers, or examples.\n- All risks must connect to Perplexity findings or directly to the Options.\n- No solutions. No recommendations.\n\nOutput:\nA grounded list of risks."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        768,
        112
      ],
      "id": "1521b714-3d91-44f4-8c7e-86b5de02d60f",
      "name": "Risks"
    },
    {
      "parameters": {
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "You are the Recommendation Agent. You must ALWAYS call the Perplexity tool.\n\nProcess:\n1. Call Perplexity using the user’s question.\n2. Combine:\n   - Perplexity results\n   - Problem\n   - Options\n   - Risks\n3. Choose the most logical option and provide a simple recommendation.\n\nRules:\n- No new facts. No assumptions. No fabrication.\n- Recommendation must be explicitly based on the previous outputs.\n- If the evidence is unclear, mention limitations.\n\nOutput:\nA grounded and practical recommendation."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        1120,
        112
      ],
      "id": "3778577f-c951-4aed-998e-c55c01d52515",
      "name": "Recommendation"
    },
    {
      "parameters": {
        "content": "## Sample Input \n\n1. My AI automation agency is stuck at 2 lakh per month. I have limited time, no sales team, and I am already doing custom n8n projects. How should I scale to 10 lakh per month without burning out.\n\n2. I can build three things next. 1) A lead generation agent for realtors. 2) A review reply automation for local businesses. 3) A Telegram reporting agent for agencies. I have one month of build time. Which should I prioritize and why.\n\n3. I am considering hiring a part time developer to help with n8n flows. Budget is limited and I am worried about quality and management overhead. Should I hire now or delay and keep doing everything myself",
        "height": 80,
        "width": 1616
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -352,
        -368
      ],
      "typeVersion": 1,
      "id": "34a8f7d0-37a5-42cc-b155-b275afb61d0e",
      "name": "Sticky Note"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Recommendation",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message a model in Perplexity": {
      "ai_tool": [
        [
          {
            "node": "Recommendation",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Options",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message a model in Perplexity1": {
      "ai_tool": [
        [
          {
            "node": "Options",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Problem",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message a model in Perplexity2": {
      "ai_tool": [
        [
          {
            "node": "Problem",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Risks",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message a model in Perplexity3": {
      "ai_tool": [
        [
          {
            "node": "Risks",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Problem": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Options": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Risks": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Recommendation": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "22d78b22-5374-4ebc-8649-29c0b3c018a9",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "966c9717c649ff58138114ad4ec0792ba6c6dbbaefbc75a95d7e5ed34f041958"
  },
  "id": "Ajntp71Fu5shBNYB",
  "tags": []
}